# Table definition
namespace: sidekick
type: DBConfig
table_name: users_decoration
depends_on: ["users"]
create_stmt: >
  CREATE TABLE IF NOT EXISTS users_decoration (
    id INTEGER PRIMARY KEY REFERENCES sidekick.users(id) ON DELETE CASCADE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    username TEXT UNIQUE CHECK (char_length(username) >= 3),
    email TEXT UNIQUE CHECK (email ~* '^.+@.+\..+$')
    );
trigger_stmt:
  - DROP TRIGGER IF EXISTS update_users_decoration_updated_at ON users_decoration;
    CREATE TRIGGER update_users_decoration_updated_at BEFORE UPDATE ON users_decoration
    FOR EACH ROW EXECUTE PROCEDURE updated_at_trigger();
description:
  table: >
    Extends the base User Identity. Introduces username and email
  columns:
    id: Auto incremental integer
    created_at: Timestamp when the user was created
    updated_at: Timestamp when the last modification has happend
    username: Text must be at least 6 characters long
    email: Text must include a single @ symbol
